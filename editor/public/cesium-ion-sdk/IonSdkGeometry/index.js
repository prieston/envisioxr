/**
 * @license
 * Cesium Analytics SDK
 * Version 1.133
 *
 * Copyright 2012-2020 Cesium GS, Inc.
 * All rights reserved.
 *
 * Patents US9153063B2 US9865085B1 US9449424B2 US10592242
 * Patents pending US15/829,786 US16/850,266 US16/851,958
 *
 * Portions licensed separately.
 * See https://github.com/CesiumGS/cesium/blob/main/LICENSE.md for open-source Cesium license.
 */

import{BoundingSphere as Se,Cartesian3 as f,ComponentDatatype as z,Geometry as Ee,GeometryAttribute as T,GeometryAttributes as Fe,IndexDatatype as Me,PrimitiveType as ze,VertexFormat as Te,buildModuleUrl as ke,defined as Le,Frozen as Ge}from"@cesium/engine";var b=new f;function ue(e){e=e??Ge.EMPTY_OBJECT,this._radius=e.radius,this._directions=e.directions,this._perDirectionRadius=e.perDirectionRadius,this._vertexFormat=e.vertexFormat??Te.DEFAULT,this._workerPath=ke("IonSdkGeometryWorkers/createFanGeometry.js")}ue.createGeometry=function(e){let n=e._vertexFormat,t=e._radius,a=Le(e._perDirectionRadius)&&e._perDirectionRadius,r=e._directions;r[0].clock<r[1].clock&&r.reverse();let i,s,d=0,c,o,g,u,h,O=new Fe,m=[],w=[],p=r.length;for(c=0;c<p;c++)u=f.fromSpherical(r[c]),c===0?(m.push(u),w.push(f.normalize(u,new f))):f.equals(m[c-1],u)||(c===p-1?f.equals(m[0],u)||(m.push(u),w.push(f.normalize(u,new f))):(m.push(u),w.push(f.normalize(u,new f))));if(p=m.length,n.position){h=(p+1)*2*3;let l=new Float64Array(h);for(o=0,c=0;c<p;c++){l[o++]=0,l[o++]=0,l[o++]=0,u=w[c];let S=a?f.magnitude(m[c]):t;l[o++]=u.x*S,l[o++]=u.y*S,l[o++]=u.z*S,d=Math.max(d,S)}l[o++]=l[0],l[o++]=l[1],l[o++]=l[2],l[o++]=l[3],l[o++]=l[4],l[o++]=l[5],O.position=new T({componentDatatype:z.DOUBLE,componentsPerAttribute:3,values:l})}if(n.normal){h=(p+1)*2*3,i=new Float32Array(h);let l;for(o=0,c=0;c<p;c++)u=m[c],c+1===p?l=m[0]:l=m[c+1],b=f.normalize(f.cross(u,l,b),b),i[o++]=b.x,i[o++]=b.y,i[o++]=b.z,i[o++]=b.x,i[o++]=b.y,i[o++]=b.z;i[o++]=i[0],i[o++]=i[1],i[o++]=i[2],i[o++]=i[3],i[o++]=i[4],i[o++]=i[5],O.normal=new T({componentDatatype:z.FLOAT,componentsPerAttribute:3,values:i})}if(n.bitangent){for(h=(p+1)*2*3,s=new Float32Array(h),o=0,c=0;c<p;c++)u=w[c],s[o++]=u.x,s[o++]=u.y,s[o++]=u.z,s[o++]=u.x,s[o++]=u.y,s[o++]=u.z;s[o++]=s[0],s[o++]=s[1],s[o++]=s[2],s[o++]=s[3],s[o++]=s[4],s[o++]=s[5],O.bitangent=new T({componentDatatype:z.FLOAT,componentsPerAttribute:3,values:s})}if(n.tangent){h=(p+1)*2*3;let l=new Float32Array(h);for(o=0,c=0;c<h;c+=6){let S=f.unpack(i,c),Ie=f.unpack(s,c),E=f.normalize(f.cross(Ie,S,b),b);l[o++]=E.x,l[o++]=E.y,l[o++]=E.z,l[o++]=E.x,l[o++]=E.y,l[o++]=E.z}O.tangent=new T({componentDatatype:z.FLOAT,componentsPerAttribute:3,values:l})}if(n.st){h=(p+1)*2*2;let l=new Float32Array(h);for(o=0,c=0;c<p;c++)g=1-c/(p+1),l[o++]=g,l[o++]=0,l[o++]=g,l[o++]=1;g=1-c/(p+1),l[o++]=g,l[o++]=0,l[o++]=g,l[o++]=1,O.st=new T({componentDatatype:z.FLOAT,componentsPerAttribute:2,values:l})}o=0,c=0,h=(p+1)*2*3;let D=Me.createTypedArray(h/3,h);for(;o<h-6;)D[o++]=c,D[o++]=c+3,D[o++]=c+1,D[o++]=c,D[o++]=c+2,D[o++]=c+3,c+=2;return D[o++]=c,D[o++]=1,D[o++]=c+1,D[o++]=c,D[o++]=0,D[o++]=1,new Ee({attributes:O,indices:D,primitiveType:ze.TRIANGLES,boundingSphere:new Se(f.ZERO,d)})};var K=ue;import{BoundingSphere as We,Cartesian3 as k,ComponentDatatype as Be,Geometry as Ne,GeometryAttribute as Ue,GeometryAttributes as je,IndexDatatype as He,PrimitiveType as Ye,VertexFormat as Je,buildModuleUrl as qe,defined as Ze,Frozen as Xe}from"@cesium/engine";var R=new k;function he(e){e=e??Xe.EMPTY_OBJECT,this._radius=e.radius,this._directions=e.directions,this._perDirectionRadius=e.perDirectionRadius,this._numberOfRings=e.numberOfRings??6,this._vertexFormat=e.vertexFormat??Je.DEFAULT,this._workerPath=qe("IonSdkGeometryWorkers/createFanOutlineGeometry.js")}he.createGeometry=function(e){let n=e._radius,t=Ze(e._perDirectionRadius)&&e._perDirectionRadius,a=e._directions,r=e._vertexFormat,i=e._numberOfRings,s,d,c,o,g=0,u,h=a.length,O=new je;if(r.position){for(d=0,o=h*3*i,u=new Float64Array(o),c=0;c<i;c++)for(s=0;s<h;s++){R=k.fromSpherical(a[s],R);let w=t?k.magnitude(R):n,p=w/i*(c+1);R=k.normalize(R,R),u[d++]=R.x*p,u[d++]=R.y*p,u[d++]=R.z*p,g=Math.max(g,w)}O.position=new Ue({componentDatatype:Be.DOUBLE,componentsPerAttribute:3,values:u})}d=0,o=h*2*i;let m=He.createTypedArray(o/3,o);for(c=0;c<i;c++){let w=c*h;for(s=0;s<h-1;s++)m[d++]=s+w,m[d++]=s+1+w;m[d++]=s+w,m[d++]=0+w}return new Ne({attributes:O,indices:m,primitiveType:Ye.LINES,boundingSphere:new We(k.ZERO,g)})};var $=he;import{CzmlDataSource as ce,DataSourceDisplay as Ve,Entity as le,GeometryVisualizer as Ae,DeveloperError as At}from"@cesium/engine";import{Cartesian3 as Ke,Color as Q,ColorGeometryInstanceAttribute as pe,ColorMaterialProperty as fe,ConstantProperty as $e,DistanceDisplayConditionGeometryInstanceAttribute as me,GeometryInstance as ge,GeometryUpdater as ee,Iso8601 as Y,MaterialAppearance as Qe,PerInstanceColorAppearance as et,Property as V,ShowGeometryInstanceAttribute as ye,defined as y,DynamicGeometryUpdater as te}from"@cesium/engine";var _e=new Q,tt=new Ke,we=new $e(6);function it(e){this.id=e,this.vertexFormat=void 0,this.directions=void 0,this.radius=void 0,this.perDirectionRadius=void 0,this.numberOfRings=void 0}function C(e,n){ee.call(this,{entity:e,scene:n,geometryOptions:new it(e),geometryPropertyName:"fan",observedPropertyNames:["availability","position","fan"]}),this._onEntityPropertyChanged(e,"fan",e.fan,void 0)}y(Object.create)&&(C.prototype=Object.create(ee.prototype),C.prototype.constructor=C);C.prototype.createFillGeometryInstance=function(e){let n=this._entity,t=n.isAvailable(e),a,r,i=new ye(t&&n.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),s=this._distanceDisplayConditionProperty.getValue(e),d=me.fromDistanceDisplayCondition(s);if(this._materialProperty instanceof fe){let c;y(this._materialProperty.color)&&(this._materialProperty.color.isConstant||t)&&(c=this._materialProperty.color.getValue(e,_e)),y(c)||(c=Q.WHITE),r=pe.fromColor(c),a={show:i,distanceDisplayCondition:d,color:r}}else a={show:i,distanceDisplayCondition:d};return new ge({id:n,geometry:new K(this._options),modelMatrix:n.computeModelMatrix(e),attributes:a})};C.prototype.createOutlineGeometryInstance=function(e){let n=this._entity,t=n.isAvailable(e),a=V.getValueOrDefault(this._outlineColorProperty,e,Q.BLACK,_e),r=this._distanceDisplayConditionProperty.getValue(e);return new ge({id:n,geometry:new $(this._options),modelMatrix:n.computeModelMatrix(e),attributes:{show:new ye(t&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:pe.fromColor(a),distanceDisplayCondition:me.fromDistanceDisplayCondition(r)}})};C.prototype._isHidden=function(e,n){return!y(e.position)||!y(n.perDirectionRadius)&&!y(n.radius)||ee.prototype._isHidden.call(this,e,n)};C.prototype._isDynamic=function(e,n){return!V.isConstant(e.position)||!V.isConstant(e.orientation)||!V.isConstant(n.perDirectionRadius)||!V.isConstant(n.radius)||!V.isConstant(n.directions)||!V.isConstant(n.outlineWidth)||!V.isConstant(n.numberOfRings)};C.prototype._getIsClosed=function(){return!1};C.prototype._setStaticOptions=function(e,n){let t=this._materialProperty instanceof fe,a=n.numberOfRings??we,r=this._options;r.vertexFormat=t?et.VERTEX_FORMAT:Qe.VERTEX_FORMAT,r.directions=n.directions.getValue(Y.MINIMUM_VALUE,r.directions),r.radius=y(n.radius)?n.radius.getValue(Y.MINIMUM_VALUE):void 0,r.perDirectionRadius=y(n.perDirectionRadius)?n.perDirectionRadius.getValue(Y.MINIMUM_VALUE):void 0,r.numberOfRings=a.getValue(Y.MINIMUM_VALUE)};C.DynamicGeometryUpdater=F;function F(e,n,t){te.call(this,e,n,t)}y(Object.create)&&(F.prototype=Object.create(te.prototype),F.prototype.constructor=F);F.prototype._isHidden=function(e,n,t){let a=V.getValueOrUndefined(e.position,t,tt),r=this._options;return!y(a)||!y(r.perDirectionRadius)&&!y(r.radius)||te.prototype._isHidden.call(this,e,n,t)};F.prototype._setOptions=function(e,n,t){let a=n.radius,r=n.perDirectionRadius,i=n.numberOfRings??we,s=this._options;s.directions=n.directions.getValue(t,s.directions),s.radius=y(a)?a.getValue(t):void 0,s.perDirectionRadius=y(r)?r.getValue(t):void 0,s.numberOfRings=i.getValue(t)};var ie=C;import{createPropertyDescriptor as x,createMaterialPropertyDescriptor as nt,defined as ot,Event as rt,Frozen as st}from"@cesium/engine";function L(e){this._show=void 0,this._showSubscription=void 0,this._radius=void 0,this._radiusSubscription=void 0,this._perDirectionRadius=void 0,this._perDirectionRadiusSubscription=void 0,this._directions=void 0,this._directionsSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._numberOfRings=void 0,this._numberOfRingsSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._definitionChanged=new rt,this.merge(e??st.EMPTY_OBJECT)}Object.defineProperties(L.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:x("show"),radius:x("radius"),perDirectionRadius:x("perDirectionRadius"),directions:x("directions"),material:nt("material"),fill:x("fill"),outline:x("outline"),outlineColor:x("outlineColor"),outlineWidth:x("outlineWidth"),numberOfRings:x("numberOfRings"),shadows:x("shadows"),distanceDisplayCondition:x("distanceDisplayCondition")});L.prototype.clone=function(e){return ot(e)||(e=new L),e.show=this.show,e.radius=this.radius,e.perDirectionRadius=this.perDirectionRadius,e.directions=this.directions,e.material=this.material,e.fill=this.fill,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.numberOfRings=this.numberOfRings,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e};L.prototype.merge=function(e){this.show=this.show??e.show,this.radius=this.radius??e.radius,this.perDirectionRadius=this.perDirectionRadius??e.perDirectionRadius,this.directions=this.directions??e.directions,this.material=this.material??e.material,this.fill=this.fill??e.fill,this.outline=this.outline??e.outline,this.outlineColor=this.outlineColor??e.outlineColor,this.outlineWidth=this.outlineWidth??e.outlineWidth,this.numberOfRings=this.numberOfRings??e.numberOfRings,this.shadows=this.shadows??e.shadows,this.distanceDisplayCondition=this.distanceDisplayCondition??e.distanceDisplayCondition};var G=L;import{Cartesian3 as De,Spherical as W,TimeInterval as at,defined as A,Color as ct,CzmlDataSource as P,ShadowMode as lt}from"@cesium/engine";function dt(e){let n=e.length,t=new Array(n/2);for(let a=0;a<n;a+=2){let r=a/2;t[r]=new W(e[a],e[a+1])}return t}function ut(e){let n=e.length,t=new Array(n/3);for(let a=0;a<n;a+=3){let r=a/3;t[r]=new W(e[a],e[a+1],e[a+2])}return t}function be(e,n,t,a){A(t.unitSpherical)?t.array=dt(t.unitSpherical):A(t.spherical)?t.array=ut(t.spherical):A(t.unitCartesian)?t.array=De.unpackArray(t.unitCartesian).map(function(r){let i=W.fromCartesian3(r);return W.normalize(i,i)}):A(t.cartesian)&&(t.array=De.unpackArray(t.cartesian).map(function(r){return W.fromCartesian3(r)})),A(t.array)&&P.processPacketData(Array,e,n,t,void 0,void 0,a)}function ht(e,n,t,a){if(A(t))if(Array.isArray(t))for(let r=0,i=t.length;r<i;r++)be(e,n,t[r],a);else be(e,n,t,a)}function J(e,n,t,a){let r=n.agi_fan;if(!A(r))return;let i=r.interval;A(i)&&(i=at.fromIso8601(i));let s=e.fan;A(s)||(e.fan=s=new G),P.processPacketData(Boolean,s,"show",r.show,i,a,t),ht(s,"directions",r.directions,t),P.processPacketData(Number,s,"radius",r.radius,i,a,t),P.processMaterialPacketData(s,"material",r.material,i,a,t),P.processPacketData(Boolean,s,"perDirectionRadius",r.perDirectionRadius,i,a,t),P.processPacketData(Boolean,s,"fill",r.fill,i,a,t),P.processPacketData(Boolean,s,"outline",r.outline,i,a,t),P.processPacketData(ct,s,"outlineColor",r.outlineColor,i,a,t),P.processPacketData(Number,s,"outlineWidth",r.outlineWidth,i,a,t),P.processPacketData(Number,s,"numberOfRings",r.numberOfRings,i,a,t),P.processPacketData(lt,s,"shadows",r.shadows,i,a,t)}import{Event as pt,createPropertyDescriptor as B,defined as ft,Frozen as mt}from"@cesium/engine";function N(e){this._color=void 0,this._colorSubscription=void 0,this._show=void 0,this._showSubscription=void 0,this._direction=void 0,this._directionSubscription=void 0,this._length=void 0,this._lengthSubscription=void 0,this._minimumLengthInPixels=void 0,this._minimumLengthInPixelsSubscription=void 0,this._definitionChanged=new pt,this.merge(e??mt.EMPTY_OBJECT)}Object.defineProperties(N.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},color:B("color"),show:B("show"),direction:B("direction"),length:B("length"),minimumLengthInPixels:B("minimumLengthInPixels")});N.prototype.clone=function(e){return ft(e)||(e=new N),e.color=this.color,e.direction=this.direction,e.length=this.length,e.minimumLengthInPixels=this.minimumLengthInPixels,e.show=this.show,e};N.prototype.merge=function(e){this.color=this.color??e.color,this.direction=this.direction??e.direction,this.length=this.length??e.length,this.minimumLengthInPixels=this.minimumLengthInPixels??e.minimumLengthInPixels,this.show=this.show??e.show};var U=N;import{TimeInterval as gt,defined as ne,Cartesian3 as yt,Color as _t,CzmlDataSource as j}from"@cesium/engine";var Ce={iso8601:void 0};function q(e,n,t,a){let r=n.agi_vector;if(!ne(r))return;let i,s=r.interval;ne(s)&&(Ce.iso8601=s,i=gt.fromIso8601(Ce));let d=e.vector;ne(d)||(e.vector=d=new U),j.processPacketData(_t,d,"color",r.color,i,a,t),j.processPacketData(Boolean,d,"show",r.show,i,a,t),j.processPacketData(yt,d,"direction",r.direction,i,a,t),j.processPacketData(Number,d,"length",r.length,i,a,t),j.processPacketData(Number,d,"minimumLengthInPixels",r.minimumLengthInPixels,i,a,t)}import{AssociativeArray as Pt,Cartesian3 as se,Color as Re,Property as M,defined as v,destroyObject as vt,BoundingSphereState as Oe}from"@cesium/engine";import{Cartesian3 as _,Color as xe,buildModuleUrl as wt,defined as Dt,destroyObject as bt,Math as Z,Model as Ct,Frozen as xt}from"@cesium/engine";function H(e){e=e??xt.EMPTY_OBJECT,this.show=e.show??!0,this.length=e.length??1,this.minimumLengthInPixels=e.minimumLengthInPixels??0,this.color=xe.clone(e.color??xe.WHITE),this.id=e.id,this._allowPicking=e.allowPicking??!0,this.debugShowBoundingVolume=e.debugShowBoundingVolume??!1,this.debugWireframe=e.debugWireframe??!1,this._position=_.clone(e.position??_.ZERO),this._direction=_.clone(e.direction??_.UNIT_Y),this._modelMatrixDirty=!0,this._model=void 0;let n={primitive:this};Ct.fromGltfAsync({url:wt("IonSdkGeometry/Assets/Models/Vector/Vector.glb"),enableDebugWireframe:!0,asynchronous:!1,pickObject:n,allowPicking:this.allowPicking}).then(t=>this._model=t).catch(t=>{this.isDestroyed()||console.log(`Error creating vector: ${t}`)})}Object.defineProperties(H.prototype,{position:{get:function(){return this._position},set:function(e){_.clone(e,this._position),this._modelMatrixDirty=!0}},direction:{get:function(){return this._direction},set:function(e){_.clone(e,this._direction),this._modelMatrixDirty=!0}},allowPicking:{get:function(){return this._allowPicking}}});var Pe=new _,ve=new _;H.prototype.update=function(e){let n=this._model;if(Dt(n)){if(n.show=this.show,n.id=this.id,n.scale=this.length,n.minimumPixelSize=this.minimumLengthInPixels,n.debugShowBoundingVolume=this.debugShowBoundingVolume,n.debugWireframe=this.debugWireframe,n.color=this.color,this._modelMatrixDirty){this._modelMatrixDirty=!1;let t=this.direction,a,r;Z.equalsEpsilon(t.x,0,Z.EPSILON14)&&Z.equalsEpsilon(t.y,0,Z.EPSILON14)?(a=_.cross(t,_.UNIT_Y,Pe),r=_.cross(a,t,ve)):(a=_.cross(t,_.UNIT_Z,Pe),r=_.cross(a,t,ve));let i=n.modelMatrix;i[0]=a.x,i[1]=a.y,i[2]=a.z,i[3]=0,i[4]=-r.x,i[5]=-r.y,i[6]=-r.z,i[7]=0,i[8]=t.x,i[9]=t.y,i[10]=t.z,i[11]=0;let s=this.position;i[12]=s.x,i[13]=s.y,i[14]=s.z,i[15]=1}return n.update(e)}};H.prototype.isDestroyed=function(){return!1};H.prototype.destroy=function(){return this._model=this._model&&this._model.destroy(),bt(this)};var oe=H;var Ot=Re.WHITE,Rt=1,Vt=0,X=new se;function I(e,n){n.collectionChanged.addEventListener(I.prototype._onCollectionChanged,this),this._scene=e,this._primitives=e.primitives,this._entityCollection=n,this._hash={},this._entitiesToVisualize=new Pt,this._onCollectionChanged(n,n.values,[],[])}I.prototype.update=function(e){let n=this._entitiesToVisualize.values,t=this._hash,a=this._primitives;for(let r=0,i=n.length;r<i;r++){let s=n[r],d=s._vector,c,o=t[s.id],g=s.isShowing&&s.isAvailable(e)&&M.getValueOrDefault(d._show,e,!0);if(g&&(X=M.getValueOrUndefined(s._position,e,X),c=M.getValueOrUndefined(d._direction,e,c),g=v(X)&&v(c)),!g){v(o)&&(o.show=!1);continue}v(o)||(o=new oe({color:Re.WHITE,id:s}),o.id=s,a.add(o),t[s.id]=o),o.show=!0,o.position=X,o.direction=se.normalize(c,c),o.length=M.getValueOrDefault(d._length,e,Rt),o.minimumLengthInPixels=M.getValueOrDefault(d._minimumLengthInPixels,e,Vt),o.color=M.getValueOrDefault(d._color,e,Ot)}return!0};I.prototype.isDestroyed=function(){return!1};I.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(I.prototype._onCollectionChanged,this);let e=this._entitiesToVisualize.values,n=this._hash,t=this._primitives;for(let a=e.length-1;a>-1;a--)re(this,e[a],n,t);return vt(this)};I.prototype.getBoundingSphere=function(e,n){let t=this._hash[e.id];return v(t)?(n.center=se.clone(t.position,n.center),n.radius=t.length,Oe.DONE):Oe.FAILED};I.prototype._onCollectionChanged=function(e,n,t,a){let r,i,s=this._entitiesToVisualize,d=this._hash,c=this._primitives;for(r=n.length-1;r>-1;r--)i=n[r],v(i._vector)&&v(i._position)&&s.set(i.id,i);for(r=a.length-1;r>-1;r--)i=a[r],v(i._vector)&&v(i._position)?s.set(i.id,i):(re(this,i,d,c),s.remove(i.id));for(r=t.length-1;r>-1;r--)i=t[r],re(this,i,d,c),s.remove(i.id)};function re(e,n,t,a){let r=t[n.id];v(r)&&(a.remove(r),r.isDestroyed()||r.destroy(),delete t[n.id])}var ae=I;function de(){if(Ve&&ce&&le&&Ae)Ve.registerVisualizer(ae),ce.registerUpdater(J),ce.registerUpdater(q),le.registerEntityType("fan",G),le.registerEntityType("vector",U),Ae.registerUpdater(ie);else throw new At("attempted to initialize sensors code before CesiumJS core")}de();globalThis.ION_SDK_VERSION="1.133";export{K as FanGeometry,ie as FanGeometryUpdater,G as FanGraphics,$ as FanOutlineGeometry,oe as Vector,U as VectorGraphics,ae as VectorVisualizer,de as initializeGeometry,J as processFan,q as processVector};
